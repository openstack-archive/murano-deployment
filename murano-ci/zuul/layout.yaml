includes:
  - python-file: openstack_functions.py

pipelines:
  - name: check
    manager: IndependentPipelineManager
    trigger:
      gerrit:
        - event: patchset-created
        - event: comment-added
          comment_filter: (?i)^(Patch Set [0-9]+:\n\n)?\s*retrigger(( (?:bug|lp)[\s#:]*(\d+))|( no bug)|( murano-ci))\s*$
        - event: comment-added
          comment_filter: recheck
    start:
      gerrit:
        verified: 0
    success:
      gerrit:
        verified: 1
    failure:
      gerrit:
        verified: -1
    failure-message: To re-run the job please post a comment with `retrigger murano-ci`

  - name: post
    description: This pipeline runs jobs that operate after each change is merged.
    manager: IndependentPipelineManager
    precedence: low
    trigger:
      gerrit:
        - event: ref-updated
          ref: ^(?!refs/).*$

projects:
  - name: openstack/murano
    check:
      - gate-murano-noglare-ubuntu
      - gate-murano-glare-ubuntu
    post:
      - hook-murano-rtfd

  - name: openstack/murano-dashboard
    check:
      - gate-murano-dashboard-noglare-ubuntu
      - gate-murano-dashboard-glare-ubuntu

  - name: openstack/murano-agent
    check:
      - gate-murano-agent-noglare-ubuntu
      - gate-murano-agent-noglare-debian

  - name: openstack/python-muranoclient
    check:
      - gate-murano-client-noglare-ubuntu
      - gate-murano-client-glare-ubuntu

  - name: openstack/murano-deployment
    check:
      - gate-murano-deployment
      - gate-murano-glare-ubuntu-nv
      - gate-murano-noglare-ubuntu-nv
      - gate-murano-dashboard-noglare-ubuntu-nv
      - gate-murano-dashboard-glare-ubuntu-nv
      - gate-murano-agent-noglare-ubuntu-nv
      - gate-murano-agent-noglare-debian-nv
      - gate-murano-client-glare-ubuntu-nv
      - gate-murano-client-noglare-ubuntu-nv
      - coverage-murano-ubuntu

jobs:
  - name: ^.*$
    parameter-function: set_params
  # -nv jobs are never voting.
  - name: ^.*-nv$
    voting: false
  - name: ^coverage-.*$
    voting: false
  - name: ^gate-murano-deployment$
    voting: false

#NOTE(kzaitsev): keep glare jobs non-voting and only run them on newton (and newer) code
  - name: ^gate-.*-glare-.*$
    branch: ^(?!stable/(?:liberty|mitaka)).*$
    voting: false
