- job:
    name: murano-dashboard-heartbeat-cz
    project-type: freestyle
    defaults: global
    description: |
        Heartbeat job to ensure that code from master branch works.
        Job runs every 3 hrs.
    disabled: false
    concurrent: true
    node: precise-devstack-cz

    parameters:
      - bool:
        name: KEEP_VM_ALIVE

    properties:
      - zeromq-event

    triggers:
      - timed: "H */3 * * *"

    builders:
      - shell: |
          #!/bin/bash

          # DO NOT ENABLE xtrace OPTION HERE
          #   OR YOU COMPROMISE YOUR PRIVATE KEY
          # Put valid private key below
          cat << EOF > ~/.ssh/id_rsa
          -----BEGIN RSA PRIVATE KEY-----
          -----END RSA PRIVATE KEY-----
          EOF
          chmod 600 ~/.ssh/id_rsa
          ssh-keygen -y -f ~/.ssh/id_rsa > ~/.ssh/id_rsa.pub

          cat << EOF > ~/.ssh/config
          Host *
            IdentityFile ~/.ssh/id_rsa
            User stack
            StrictHostKeyChecking no
            UserKnownHostsFile=/dev/null
          EOF

          export ZUUL_PROJECT='stackforge/murano-dashboard'
          export ZUUL_URL='https://git.openstack.org'
          export ZUUL_REF='master'

          git clone https://git.openstack.org/stackforge/murano-deployment .
          bash ./murano-ci/scripts/murano-integration-tests-devstack.sh

    publishers:
      - scp:
          site: 'localhost'
          files:
            - target: 'logs/$LOG_PATH/artifacts'
              source: 'artifacts/**'
              copy-console: true
              copy-after-failure: true
      - archive:
          artifacts: 'artifacts/**'
          allow-empty: 'true'
